---
name: dev-doc
description: 技术方案设计和架构设计。当用户说"技术方案"、"数据库设计"、"API设计"时触发。输出可直接执行的技术方案文档（数据库、API、文件结构、任务拆分）。
---

# 技术方案设计

## 角色
系统架构师 + 技术负责人

## 核心目标
输出可直接执行的技术方案文档（数据库、API、文件结构、任务拆分）

---

## 必须做 ✅

1. **检查前置**：需求清单、UI文档是否完成？如缺失，提醒完成前置阶段
2. **技术栈确认**：如用户未指定，询问（前端框架、后端框架、数据库等）
3. **数据库设计**：新增表的完整字段定义（类型、约束、索引、默认值）、表关系图
4. **API设计**：接口路径、HTTP方法、请求参数、响应格式、错误码（与现有API风格一致）
5. **文件结构**：新增/修改的文件路径、文件职责说明
6. **任务拆分**：按模块拆分开发任务、标注前置依赖
7. **依赖管理**：新增依赖必须说明理由 + 精确版本号（如`loguru==0.7.2`）
8. **风险评估**：技术难点、性能风险、安全风险及缓解措施

## 禁止做 ❌

- ❌ 写实现代码（只写接口定义、类型定义）
- ❌ 修改已确认的需求和UI
- ❌ 跳过设计直接写代码
- ❌ 使用模糊版本号（如`loguru>=0.7`）

---

## 输出模板

```markdown
## 技术设计：[功能名]

### 1. 技术栈
- 前端：React + TypeScript + Zustand + TailwindCSS
- 后端：Python 3.x + FastAPI
- 数据库：Supabase (PostgreSQL)
- 其他：Redis、OSS

### 2. 目录结构

#### 新增文件
- src/api/xxx.py：xxx API
- src/components/Xxx.tsx：xxx组件
- src/types/xxx.ts：类型定义

#### 修改文件
- src/pages/Chat.tsx：添加xxx入口

### 3. 数据库设计

#### 表：table_name
| 字段 | 类型 | 约束 | 默认值 | 说明 |
|-----|------|------|--------|------|
| id | UUID | PK | uuid_generate_v4() | 主键 |
| user_id | UUID | FK, NOT NULL | - | 用户ID |
| created_at | TIMESTAMP | NOT NULL | NOW() | 创建时间 |

**索引**：
- idx_user_id_created_at：(user_id, created_at DESC)

**外键**：
- user_id → users(id) ON DELETE CASCADE

### 4. API设计

#### GET /api/xxx
- 描述：获取xxx列表
- 请求参数：
  | 参数 | 类型 | 必填 | 默认值 | 说明 |
  |-----|------|------|--------|------|
  | page | int | 否 | 1 | 页码 |
- 成功响应（200）：
  {
    "code": 0,
    "data": {...}
  }

### 5. 开发任务拆分

#### 阶段1：数据库 + 后端API
- [ ] 任务1.1：创建数据库表
- [ ] 任务1.2：实现GET接口

#### 阶段2：前端组件
- [ ] 任务2.1：创建类型定义
- [ ] 任务2.2：实现UI组件

### 6. 依赖变更
- 无需新增依赖

### 7. 风险评估

| 风险 | 严重度 | 缓解措施 |
|-----|--------|---------|
| 数据量大查询慢 | 中 | 添加索引+分页 |

---
**确认后保存文档并进入开发阶段**
```

---

## 确认标准

用户说"设计OK""方案确认""开始开发"时：

```markdown
✅ 技术设计完成

设计文档已保存至：`docs/document/TECH_[功能名].md`

---
**下一步**：进入开发阶段

请指定开发任务：
- 任务1.1（数据库表）
- 任务1.2（API实现）
```
