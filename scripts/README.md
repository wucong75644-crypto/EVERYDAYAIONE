# ğŸ› ï¸ é¡¹ç›®å·¥å…·è„šæœ¬

æœ¬ç›®å½•åŒ…å«é¡¹ç›®ç»´æŠ¤å’Œç®¡ç†çš„å„ç§è„šæœ¬å·¥å…·ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ security/          # å®‰å…¨ç›¸å…³è„šæœ¬
â”‚   â”œâ”€â”€ update_env.sh          # æ›´æ–°ç¯å¢ƒå˜é‡å¯†é’¥
â”‚   â””â”€â”€ verify_supabase.py     # éªŒè¯ Supabase è¿æ¥
â”œâ”€â”€ database/          # æ•°æ®åº“ç›¸å…³è„šæœ¬
â”‚   â””â”€â”€ apply_migration.sh     # åº”ç”¨æ•°æ®åº“è¿ç§»
â””â”€â”€ README.md          # æœ¬æ–‡ä»¶
```

---

## ğŸ” å®‰å…¨è„šæœ¬ (security/)

### update_env.sh

**ç”¨é€”**ï¼šäº¤äº’å¼æ›´æ–° Supabase å¯†é’¥

**ä½¿ç”¨åœºæ™¯**ï¼š
- é‡ç½® Supabase Service Role Key åæ›´æ–° .env æ–‡ä»¶
- å¯†é’¥æ³„éœ²åç´§æ€¥æ›´æ¢

**ç”¨æ³•**ï¼š
```bash
bash scripts/security/update_env.sh
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨å¤‡ä»½åŸ .env æ–‡ä»¶
- äº¤äº’å¼è¾“å…¥æ–°å¯†é’¥
- æ”¯æŒåŒæ—¶æ›´æ–° anon key

---

### verify_supabase.py

**ç”¨é€”**ï¼šéªŒè¯ Supabase è¿æ¥å’Œå¯†é’¥æœ‰æ•ˆæ€§

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ›´æ–°å¯†é’¥åéªŒè¯è¿æ¥
- æ’æŸ¥æ•°æ®åº“è¿æ¥é—®é¢˜
- ç¡®è®¤ .env é…ç½®æ­£ç¡®

**ç”¨æ³•**ï¼š
```bash
cd backend
source venv/bin/activate
python3 ../scripts/security/verify_supabase.py
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ” éªŒè¯ Supabase å¯†é’¥...
ğŸ“¡ URL: https://qcaatwmlzqqnzfjdzlzm.supabase.co
ğŸ”‘ Service Key: eyJhbGciOiJIUzI1N...
âœ… è¿æ¥æˆåŠŸï¼
âœ… æ•°æ®åº“å“åº”æ­£å¸¸
ğŸ“Š ç”¨æˆ·æ€»æ•°: 42
ğŸ‰ å¯†é’¥éªŒè¯é€šè¿‡ï¼
```

---

## ğŸ’¾ æ•°æ®åº“è„šæœ¬ (database/)

### apply_migration.sh

**ç”¨é€”**ï¼šæ˜¾ç¤ºæ•°æ®åº“è¿ç§»æŒ‡ä»¤

**ä½¿ç”¨åœºæ™¯**ï¼š
- åº”ç”¨æ–°çš„æ•°æ®åº“è¿ç§»
- æŸ¥çœ‹è¿ç§» SQL å†…å®¹

**ç”¨æ³•**ï¼š
```bash
bash scripts/database/apply_migration.sh
```

**è¾“å‡º**ï¼š
- æ˜¾ç¤ºéœ€è¦åœ¨ Supabase Dashboard æ‰§è¡Œçš„ SQL
- æä¾› Dashboard é“¾æ¥

---

## âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹

### ç¯å¢ƒè¦æ±‚
- Python 3.12+
- å·²æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒ (backend/venv)
- æ­£ç¡®é…ç½®çš„ .env æ–‡ä»¶

### å®‰å…¨æé†’
- âŒ ä¸è¦å°†è¿™äº›è„šæœ¬æäº¤åˆ°å…¬å…±ä»“åº“ï¼ˆå¦‚æœåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
- âœ… è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶
- âœ… æ‰€æœ‰å¯†é’¥è¾“å…¥ä¸ä¼šæ˜¾ç¤ºåœ¨ç»ˆç«¯

### æƒé™ç®¡ç†
æ‰€æœ‰è„šæœ¬éƒ½è®¾ç½®äº†å¯æ‰§è¡Œæƒé™ï¼š
```bash
chmod +x scripts/**/*.sh
chmod +x scripts/**/*.py
```

---

## ğŸ“ æ·»åŠ æ–°è„šæœ¬

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„å·¥å…·è„šæœ¬ï¼š

1. **é€‰æ‹©åˆé€‚çš„ç›®å½•**ï¼š
   - å®‰å…¨ç›¸å…³ â†’ `security/`
   - æ•°æ®åº“ç›¸å…³ â†’ `database/`
   - éƒ¨ç½²ç›¸å…³ â†’ åˆ›å»º `deploy/`
   - æµ‹è¯•ç›¸å…³ â†’ åˆ›å»º `testing/`

2. **è„šæœ¬å‘½åè§„èŒƒ**ï¼š
   - ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
   - Shell è„šæœ¬ï¼š`.sh` åç¼€
   - Python è„šæœ¬ï¼š`.py` åç¼€
   - ç¤ºä¾‹ï¼š`backup_database.sh`, `seed_data.py`

3. **æ·»åŠ æ–‡æ¡£**ï¼š
   - åœ¨è„šæœ¬å¼€å¤´æ·»åŠ æ³¨é‡Šè¯´æ˜ç”¨é€”
   - åœ¨æœ¬ README ä¸­æ·»åŠ ä½¿ç”¨è¯´æ˜

4. **è®¾ç½®æƒé™**ï¼š
   ```bash
   chmod +x scripts/path/to/script
   ```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å®‰å…¨æ£€æŸ¥æ¸…å•](../docs/SECURITY_CHECKLIST.md)
- [å®‰å…¨ä¿®å¤æŠ¥å‘Š](../docs/SECURITY_FIXES_2026-01-28.md)
- [æ•°æ®åº“è¿ç§»](../docs/database/migrations/)

---

**æœ€åæ›´æ–°**: 2026-01-28
